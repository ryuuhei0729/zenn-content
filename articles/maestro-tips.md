---
title: "【maestro】動的な出力をアサーションするtips"
emoji: "👻"
type: "tech" # tech: 技術記事 / idea: アイデア
topics: ["Maestro", "E2Eテスト", "モバイルアプリ", "QA", "テスト自動化"]
published: false
---

こんにちは、QAエンジニアの細井です。
我々のチームではモバイルアプリのE2Eテストにmaestroを導入しているのですが、ワザップ的な使える記事が少ないので、自分が実装をしていて便利そうなtipsをここに書いていこうと思います。

※maestroはオープンソースでまだ発展途上中なので、今後もっと良い方法が発見されるかもしれません。その時は追加で記事を書こうと思います🙋‍♂️

まず、超基本的な動作として、ブラウザテストは[操作 -> 確認]の２ステップで行われます。
グロービスアプリで例えると、下記のようなものです。

やりたいテスト：トップ画面から、カテゴリ画面に遷移し、そこからコース詳細画面に遷移できること。
1. ホーム画面のカテゴリ「思考・コミュニケーション」をタップする。[tapOn: "思考・コミュニケーション"]
2. 「最短理解MBA　クリティカル・シンキング」をタップする。[tapOn: "最短理解MBA　クリティカル・シンキング"]
3. 「最短理解MBA　クリティカル・シンキング」のコースに遷移されていることを確認する。
    [assertVisible: コース詳細]
    [assertVisible: 最短理解MBA　クリティカル・シンキング]
     
※手順1のクリックは今回はテキストベースで取ってきていますが、もちろんIDを振って取ってくることも可能です。
(IDの振り方の記事をiOS, Androidどちらも貼る。)

しかし、ビジネス要件次第でこのテストは落ちてしまいます。。。
例えば、このコースが非公開になったらこのテストは失敗しますし、なんならコース名が1文字でも変わったらこのテストは失敗します。

そのため、できれば「course-title」という変数を用意してコースタイトルを格納し、遷移後にその文言でアサーションしたいです。
いくつか対策はあるかと思いますが、私が採用したのは下記の手法です。

ポイント：コピーの機能を利用して、クリップボードを用いてアサーションする

copyTextFrom: 
  id: course-title
  index: 0
tapOn: 
  id: course-title
  index: 0
assertVisible: [masetro ClipBoard]

※並んでいるコースタイトルにIDを振って、その1番目をクリップボードにコピー後、クリックするということをしてます。

これが現状最も行数が少なく動的なアサーションができる手法かと思います。

